<div class="admin-dashboard-wrapper p-4 bg-50 min-h-screen" *ngIf="dashboardData$ | async as data">
  <!-- Header Section -->
  <div class="flex flex-column md:flex-row justify-content-between align-items-center mb-6 gap-3 pt-2">
    <div>
      <h1 class="text-3xl font-bold text-900 m-0">Dashboard Overview</h1>
      <p class="text-600 m-0 text-sm">Welcome back to your system management hub</p>
    </div>
    <div class="flex gap-2">
      <p-tag severity="info" [value]="(today | date:'MMM d, y') ?? ''" styleClass="px-3 py-1 font-semibold"></p-tag>
    </div>
  </div>

  <!-- KPI Grid -->
  <div class="grid mb-5">
    <div *ngFor="let stat of data.stats" class="col-12 md:col-6 lg:col-3">
      <p-card styleClass="shadow-2 border-round-xl hover:shadow-4 transition-all">
        <div class="flex justify-content-between align-items-center mb-3">
          <div class="flex align-items-center justify-content-center border-round-lg w-3rem h-3rem"
            [ngClass]="stat.bg || ''">
            <i [class]="'pi ' + stat.icon + ' text-xl'" [style.color]="'var(--' + stat.color + '-700)'"></i>
          </div>
          <div class="text-right">
            <span class="block text-500 font-bold uppercase text-xs mb-1">{{ stat.title }}</span>
            <div class="text-2xl font-bold text-900">{{ stat.value }}</div>
          </div>
        </div>
        <div class="text-sm font-semibold text-green-600">
          <i class="pi pi-arrow-up text-xs mr-1"></i>
          {{ stat.trendLabel }}
        </div>
      </p-card>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="grid mb-5">
    <!-- Daily Patient Inflow Line Chart -->
    <div class="col-12 lg:col-7">
      <p-card styleClass="shadow-2 border-round-xl h-full">
        <ng-template pTemplate="title">
          <div class="flex align-items-center gap-2">
            <div class="w-2rem h-2rem border-round-lg flex align-items-center justify-content-center"
              style="background: linear-gradient(135deg, #0891b2, #06b6d4);">
              <i class="pi pi-chart-line text-white" style="font-size:0.75rem;"></i>
            </div>
            <span class="text-lg font-bold">Patient Inflow Today</span>
          </div>
        </ng-template>
        <p-chart type="line" [data]="data.dailyVisits" [options]="lineChartOptions" height="260px"></p-chart>
      </p-card>
    </div>

    <!-- Department Distribution Doughnut -->
    <div class="col-12 lg:col-5">
      <p-card styleClass="shadow-2 border-round-xl h-full">
        <ng-template pTemplate="title">
          <div class="flex align-items-center gap-2">
            <div class="w-2rem h-2rem border-round-lg flex align-items-center justify-content-center"
              style="background: linear-gradient(135deg, #7c3aed, #8b5cf6);">
              <i class="pi pi-chart-pie text-white" style="font-size:0.75rem;"></i>
            </div>
            <span class="text-lg font-bold">Department Distribution</span>
          </div>
        </ng-template>
        <p-chart type="doughnut" [data]="data.departmentDist" [options]="doughnutChartOptions" height="260px"></p-chart>
      </p-card>
    </div>
  </div>

  <!-- Workload Bar Chart + Activity Row -->
  <div class="grid">
    <!-- Department Workload Bar Chart -->
    <div class="col-12 lg:col-7">
      <p-card styleClass="shadow-2 border-round-xl h-full">
        <ng-template pTemplate="title">
          <div class="flex align-items-center gap-2">
            <div class="w-2rem h-2rem border-round-lg flex align-items-center justify-content-center"
              style="background: linear-gradient(135deg, #059669, #10b981);">
              <i class="pi pi-chart-bar text-white" style="font-size:0.75rem;"></i>
            </div>
            <span class="text-lg font-bold">Department Workload</span>
          </div>
        </ng-template>
        <p-chart type="bar" [data]="data.workload" [options]="barChartOptions" height="260px"></p-chart>
      </p-card>
    </div>

    <!-- Activity Section -->
    <div class="col-12 lg:col-5">
      <p-card styleClass="shadow-2 border-round-xl h-full">
        <ng-template pTemplate="title">
          <span class="text-lg font-bold">Recent Activity</span>
        </ng-template>

        <div class="timeline-stream" style="max-height: 280px; overflow-y: auto; padding-right: 4px;">
          <div *ngFor="let activity of data.activities; let last = last" class="mb-4">
            <div class="flex align-items-start gap-3 p-3 border-round-lg bg-50">
              <div
                class="w-2rem h-2rem flex-shrink-0 flex align-items-center justify-content-center border-circle bg-white shadow-1">
                <i [class]="activity.icon + ' ' + (activity.color || 'text-primary') + ' text-sm'"></i>
              </div>
              <div class="flex-grow-1">
                <div class="flex justify-content-between mb-1">
                  <span class="text-sm font-bold text-900">{{ activity.message }}</span>
                  <span class="text-xs text-500">{{ activity.timeLabel }}</span>
                </div>
                <p class="m-0 text-xs text-600">Administrative system update.</p>
              </div>
            </div>
          </div>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Bottom Quick Access -->
  <div class="mt-6">
    <h3 class="text-lg font-bold text-900 mb-4">Quick Management</h3>
    <div class="grid">
      <div class="col-6 md:col-4 lg:col-2">
        <div
          class="surface-card p-4 border-round-xl shadow-2 text-center hover:bg-primary-50 transition-all cursor-pointer border-1 surface-border group"
          routerLink="/admin/users">
          <i class="pi pi-users text-2xl mb-2 text-primary"></i>
          <div class="font-semibold text-sm">Users</div>
        </div>
      </div>
      <div class="col-6 md:col-4 lg:col-2">
        <div
          class="surface-card p-4 border-round-xl shadow-2 text-center hover:bg-primary-50 transition-all cursor-pointer border-1 surface-border group"
          routerLink="/admin/patients">
          <i class="pi pi-id-card text-2xl mb-2 text-primary"></i>
          <div class="font-semibold text-sm">Patients</div>
        </div>
      </div>

    </div>
  </div>

</div>